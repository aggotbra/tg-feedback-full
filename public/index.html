<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tiger.com Feedback — мастер</title>
  <style>
    :root { --btn:#2542e6; --btnText:#000; --bg:#0b1220; --card:rgba(255,255,255,.06); --line:rgba(255,255,255,.14); --muted:#cfd6e4; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#fff}
    .wrap{max-width:900px;margin:34px auto;padding:0 20px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{background:var(--btn);color:var(--btnText);border:0;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:800}
    .ghost{background:transparent;color:#fff;border:1px solid var(--line);font-weight:700}
    .seg{padding:8px 12px;border-radius:999px;border:1px solid var(--line);cursor:pointer}
    .seg.active{background:var(--btn);color:var(--btnText);border-color:transparent}
    textarea{width:100%;min-height:140px;background:rgba(255,255,255,.05);border:1px solid var(--line);border-radius:12px;color:#fff;padding:10px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h2 style="margin:0 0 12px 0;">Tiger.com Feedback</h2>

    <!-- Шаг 1 -->
    <section id="p1" class="card">
      <div>Кто вы?</div>
      <div class="row">
        <button class="btn" id="p1-user">Вы пользователь?</button>
        <button class="btn" id="p1-admin">Вы админ?</button>
      </div>
    </section>

    <!-- Шаг 2 -->
    <section id="p2" class="card hidden">
      <div>Выберите продукт</div>
      <div id="seg-products" class="row"></div>
      <div class="row"><button class="btn ghost" id="p2-back">Назад</button><button class="btn" id="p2-next">Далее</button></div>
    </section>

    <!-- Шаг 3 -->
    <section id="p3" class="card hidden">
      <div>Выберите тему</div>
      <div id="seg-topics" class="row"></div>
      <div class="row"><button class="btn ghost" id="p3-back">Назад</button><button class="btn" id="p3-next">Далее</button></div>
    </section>

    <!-- Шаг 4 -->
    <section id="p4" class="card hidden">
      <div>Опишите ваше предложение</div>
      <textarea id="idea" placeholder="Опишите улучшение..."></textarea>
      <div class="row"><button class="btn ghost" id="p4-back">Назад</button><button class="btn" id="p4-send">Отправить</button></div>
    </section>

    <!-- Шаг 5 -->
    <section id="p5" class="card hidden">
      <h3 style="margin:0 0 6px 0;">Спасибо!</h3>
      <p>Ваш фидбек отправлен в телеграм-канал <b>@tigerfeedbackkkkk</b>.</p>
      <pre id="preview" style="white-space:pre-wrap;background:rgba(255,255,255,.06);padding:10px;border-radius:12px;"></pre>
      <div class="row"><button class="btn" id="p5-home">На главную</button></div>
    </section>
  </div>

<script>
const PRODUCTS=['Tiger.com Windows','Tiger.com macOS','Tiger.com Broker'];
const TOPICS={
  'Tiger.com Windows':['Стакан','График','Котировки','Подключения','Кастомизация','Индикаторы','Графические объекты','Другое'],
  'Tiger.com macOS':['Стакан','График','Котировки','Подключения','Кастомизация','Индикаторы','Графические объекты','Другое'],
  'Tiger.com Broker':['Риск-менеджер','Субаккаунты','TigerX','Плечо','Депозит','Вывод','Безопасность','Кастомизация']
};
const state={ product:PRODUCTS[0], topic:null, text:'' };

const show=id=>['p1','p2','p3','p4','p5'].forEach(x=>document.getElementById(x).classList.toggle('hidden',x!==id));
const seg=(el,vals,cur)=>{ el.innerHTML=vals.map(v=>`<div class="seg ${v===cur?'active':''}" data-v="${v}">${v}</div>`).join(''); };

document.getElementById('p1-user').onclick=()=>{ seg(document.getElementById('seg-products'),PRODUCTS,state.product); show('p2'); };
document.getElementById('p1-admin').onclick=()=>{ alert('Вход в админку добавим позже'); };

document.getElementById('seg-products').onclick=(e)=>{ const d=e.target.closest('.seg'); if(!d) return; state.product=d.dataset.v; seg(document.getElementById('seg-products'),PRODUCTS,state.product); };
document.getElementById('p2-back').onclick=()=> show('p1');
document.getElementById('p2-next').onclick=()=>{ const t=TOPICS[state.product]; state.topic=t[0]; seg(document.getElementById('seg-topics'),t,state.topic); show('p3'); };

document.getElementById('seg-topics').onclick=(e)=>{ const d=e.target.closest('.seg'); if(!d) return; state.topic=d.dataset.v; seg(document.getElementById('seg-topics'),TOPICS[state.product],state.topic); };
document.getElementById('p3-back').onclick=()=> show('p2');
document.getElementById('p3-next').onclick=()=> show('p4');

document.getElementById('p4-back').onclick=()=> show('p3');
document.getElementById('p4-send').onclick=async()=>{
  state.text = document.getElementById('idea').value.trim();
  if(!state.text) return alert('Опишите предложение');
  try{
    const r = await fetch('/api/suggestions', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ product: state.product, topic: state.topic, text: state.text }) });
    const j = await r.json();
    document.getElementById('preview').textContent = `ID: ${j.id}\nПродукт: ${state.product}\nТема: ${state.topic}\nСодержание фидбек:\n${state.text}`;
    show('p5');
    document.getElementById('idea').value='';
  }catch(e){
    alert('Ошибка отправки: ' + e.message);
  }
};
document.getElementById('p5-home').onclick=()=> show('p1');
</script>
</body>
</html>
